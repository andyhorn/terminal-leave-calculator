<!DOCTYPE html>
<html>
  <head>
    <title>Terminal Leave Calculator</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
      integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
      crossorigin="anonymous"
    />
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
  </head>
  <body>
    <div id="app" v-cloak>
      <div class="container">
        <!-- Header Section -->
        <section class="section">
          <h1>Terminal Leave Calculator</h1>
          <div class="d-flex justify-content-between">
            <button
              class="btn btn-primary w-25"
              :disabled="isBackDisabled"
              @click="onBack"
            >
              Back
            </button>
            <button
              class="btn btn-primary w-25"
              :disabled="isNextDisabled"
              @click="onNext"
            >
              Next
            </button>
          </div>
        </section>

        <!-- Situation Selection -->
        <section class="section" v-if="currentStep == 0">
          <div class="row">
            <div
              class="col d-flex flex-column justify-content-center align-items-center"
            >
              <p>What is your situation?</p>
              <p v-if="selectedSituation">
                You selected: {{ selectedSituation }}
              </p>
            </div>
            <div class="col">
              <div class="border rounded p-4">
                <div class="form-group">
                  <label for="situation-picker">Pick an Option</label>
                  <select
                    id="situation-picker"
                    v-model="selectedSituation"
                    class="form-control"
                  >
                    <option
                      v-for="(option, index) in situations"
                      :key="index"
                      :value="option"
                      >{{ option }}</option
                    >
                  </select>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Plan to Retire Section -->
        <section class="section" v-if="currentStep == 1">
          <div class="row">
            <div
              class="col d-flex flex-column justify-content-center align-items-center"
            >
              <p class="m-0 p-0">When do you plan to retire?</p>
              <p v-if="retirementDate" class="text-center">
                You selected a retirement date of: {{ retirementDate }}
              </p>
              <p class="text-danger text-center" v-if="dateWarning">
                Note: You can only retire on the 1st of the month; Your date has
                been automatically adjusted.
              </p>
            </div>
            <div class="col">
              <div class="border rounded p-4">
                <div class="form-group">
                  <label for="#retire-on-date-picker">Retire On</label>
                  <input
                    id="retire-on-date-picker"
                    class="form-control"
                    @change="handleRetirementOnDatePickerChange"
                    type="date"
                    :min="minDate"
                    v-model="retireOnDate"
                  />
                </div>
              </div>
              <p class="my-5 p-0 text-center">OR</p>
              <div class="border rounded p-4">
                <div class="form-inline">
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <div class="input-group-text">Retire</div>
                    </div>
                    <input
                      type="number"
                      v-model="retireFromYears"
                      class="form-control"
                      min="0"
                      max="100"
                      @change="handleRetireFromYearsChange"
                    />
                    <div class="input-group-append">
                      <div class="input-group-text">years from</div>
                    </div>
                    <input
                      type="date"
                      v-model="retireFromDate"
                      class="form-control w-25"
                      :min="minDate"
                      @change="handleRetirementFromDatePickerChange"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- CONUS or OCOUNUS Section -->
        <section class="section" v-if="currentStep == 2">
          <div class="row">
            <div
              class="col d-flex flex-column justify-content-center align-items-center"
            >
              <p>At the time of retirement, will you be CONUS or OCONUS?</p>
              <p v-if="conusSelection">
                You selected: {{ conusSelection.toUpperCase() }}
              </p>
            </div>
            <div class="col">
              <div class="border rounded p-4">
                <div class="custom-control custom-radio p-3">
                  <input
                    class="custom-control-input"
                    type="radio"
                    id="conus-radio"
                    name="conus-selection"
                    value="conus"
                    v-model="conusSelection"
                  />
                  <label
                    for="conus-radio"
                    class="custom-control-label"
                    :class="{ 'radio-active': conusSelection == 'conus' }"
                    >CONUS</label
                  >
                </div>
                <div class="custom-control custom-radio p-3">
                  <input
                    class="custom-control-input"
                    type="radio"
                    id="oconus-radio"
                    name="conus-selection"
                    value="oconus"
                    v-model="conusSelection"
                  />
                  <label
                    for="oconus-radio"
                    class="custom-control-label"
                    :class="{ 'radio-active': conusSelection == 'oconus' }"
                    >OCONUS</label
                  >
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Days of Leave Section -->
        <section class="section" v-if="currentStep == 3">
          <div class="row">
            <div
              class="col d-flex flex-column justify-content-center align-items-center"
            >
              <p>How many days of leave do you plan to have?</p>
            </div>
            <div
              class="col d-flex flex-column justify-content-center align-items-center"
            >
              <div class="border rounded p-3">
                <div class="input-group">
                  <div class="input-group-prepend">
                    <div class="input-group-text">
                      Days of Leave:
                    </div>
                  </div>
                  <input
                    type="number"
                    min="0"
                    max="100"
                    id="days-of-leave-input"
                    v-model="daysOfLeave"
                    class="form-control"
                  />
                  <div class="input-group-append">
                    <button
                      class="btn btn-primary"
                      @click="calculateDaysOfLeave"
                    >
                      Calculate
                    </button>
                  </div>
                </div>
                <p class="text-center m-0 p-4">OR</p>
                <button
                  class="btn btn-primary"
                  @click="calculateMaxDaysOfLeave"
                >
                  Calculate Assuming Standard Maximum
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- Additional Days Section -->
        <section class="section" v-if="currentStep == 4">
          <div class="row">
            <div class="col">
              <p>
                As an involuntary seperatee, you can receive up to thirty (30)
                days of extra leave or ten (10) days of PTDY for transitional
                assistance.
              </p>
              <p>Do you plan to use either?</p>
            </div>
            <div class="col">
              <div class="border rounded p-3">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="involuntaryAssistance"
                    id="involuntary-none-radio"
                    value="0"
                    v-model="involuntaryAssistance"
                  />
                  <label class="form-check-label" for="involuntary-none-radio"
                    >None</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="involuntaryAssistance"
                    id="involuntary-ten-radio"
                    value="10"
                    v-model="involuntaryAssistance"
                  />
                  <label class="form-check-label" for="involuntary-ten-radio"
                    >Ten Days of PTDY</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="involuntaryAssisstance"
                    id="involuntary-thirty-radio"
                    value="30"
                    v-model="involuntaryAssistance"
                  />
                  <label class="form-check-label" for="involuntary-thirty-radio"
                    >Thirty Days of Extra Leave</label
                  >
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="section" v-if="currentStep == 5">
          <div class="row">
            <div class="col">
              <div class="border rounded p-3 text-center w-100">
                <p>You should start your leave on:</p>
                <h2 class="text-success">{{ beginTerminalLeaveDate }}</h2>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <table class="table">
                <thead>
                  <tr>
                    <th>Final Separation Date</th>
                    <th v-if="daysOfPtdy !== null">Days of PTDY</th>
                    <th v-if="daysOfTerminalLeave !== null">
                      Days of Terminal Leave
                    </th>
                    <th v-if="additionalDaysOfLeave !== null">
                      Days of Additional Leave
                    </th>
                    <th>CONUS/OCONUS Days of Leave</th>
                    <th>Total Leave Days</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>{{ retirementDate }}</td>
                    <td v-if="daysOfPtdy !== null">{{ daysOfPtdy }}</td>
                    <td v-if="daysOfTerminalLeave !== null">
                      {{ daysOfTerminalLeave }}
                    </td>
                    <td v-if="additionalDaysOfLeave !== null">
                      {{ additionalDaysOfLeave }}
                    </td>
                    <td>{{ daysOfConusLeave }}</td>
                    <td>{{ totalDaysOfLeave }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </div>
    </div>
  </body>

  <style>
    .section {
      padding-top: 3rem;
      padding-bottom: 3rem;
    }
    label.radio-active {
      font-size: 1.1rem;
      font-weight: bold;
      color: green;
    }
    [v-cloak] {
      display: none;
    }
  </style>

  <script>
    var app = new Vue({
      el: "#app",
      data: {
        DAYS_OF_LEAVE_PER_MONTH: 2.5,
        situations: [
          "I plan to retire",
          "I plan to separate",
          "I am being honorably involuntarily separated",
        ],
        selectedSituation: "",
        steps: [0, 1, 2, 3, 4, 5],
        currentStep: 0,
        retireOnDate: null,
        retireFromDate: null,
        retirementDate: null,
        retirementTicks: 0,
        dateWarning: false,
        conusSelection: null,
        retireFromYears: 20,
        months: [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December",
        ],
        daysOfLeave: 0,
        daysOfPtdy: null,
        daysOfTerminalLeave: null,
        additionalDaysOfLeave: null,
        involuntaryAssistance: null,
      },
      computed: {
        minDate() {
          const today = new Date();
          return `${today.getMonth()}/${today.getDate()}/${today.getFullYear()}`;
        },
        isBackDisabled() {
          return this.currentStep == 0;
        },
        isNextDisabled() {
          if (this.currentStep == 0) return this.selectedSituation == "";

          if (this.currentStep == 1) return this.retirementDate == null;

          if (this.currentStep == 2) return this.conusSelection == null;

          if (this.currentStep == 4) return this.involuntaryAssistance == null;

          return true;
        },
        beginTerminalLeaveDate() {
          const finalSepDate = new Date(this.retirementTicks);

          const MS_PER_SEC = 1000;
          const SEC_PER_MIN = 60;
          const MIN_PER_HOUR = 60;
          const HOUR_PER_DAY = 24;

          const millisecondsOfLeave =
            this.totalDaysOfLeave *
            HOUR_PER_DAY *
            MIN_PER_HOUR *
            SEC_PER_MIN *
            MS_PER_SEC;

          const beginLeaveTime = finalSepDate.getTime() - millisecondsOfLeave;
          const leaveDate = new Date();
          leaveDate.setTime(beginLeaveTime);

          return `${leaveDate.getUTCDate()} ${
            this.months[leaveDate.getUTCMonth()]
          }, ${leaveDate.getUTCFullYear()}`;
        },
        daysOfConusLeave() {
          return this.conusSelection == "conus" ? 20 : 30;
        },
        totalDaysOfLeave() {
          let days = 0;

          if (this.daysOfPtdy) days += Number(this.daysOfPtdy);

          if (this.daysOfTerminalLeave)
            days += Number(this.daysOfTerminalLeave);

          if (this.additionalDaysOfLeave)
            days += Number(this.additionalDaysOfLeave);

          days += Number(this.daysOfConusLeave);

          return days;
        },
      },
      methods: {
        onBack() {
          if (this.currentStep != 5) this.currentStep -= 1;
          else {
            if (this.selectedSituation == this.situations[2])
              this.currentStep -= 1;
            else this.currentStep -= 2;
          }
        },
        onNext() {
          if (this.currentStep != 3) {
            if (this.currentStep == 4) {
              switch (this.involuntaryAssistance) {
                case "10":
                  this.daysOfPtdy = 10;
                  this.additionalDaysOfLeave = null;
                  break;
                case "30":
                  this.additionalDaysOfLeave = 30;
                  this.daysOfPtdy = null;
                  break;
              }
            }
            this.currentStep += 1;
          } else if (this.selectedSituation == this.situations[2])
            this.currentStep += 1;
          else this.currentStep += 2;
        },
        calculateDaysOfLeave() {
          this.daysOfTerminalLeave = this.daysOfLeave;
          this.onNext();
        },
        calculateMaxDaysOfLeave() {
          this.daysOfTerminalLeave = 0;
          this.daysOfLeave = 0;

          const retirementDate = new Date(this.retirementTicks);
          const today = new Date();

          const retirementYear = retirementDate.getUTCFullYear();
          const currentYear = today.getUTCFullYear();

          const retirementMonth = retirementDate.getUTCMonth();
          const currentMonth = today.getUTCMonth();

          const differenceInYears = retirementYear - currentYear;

          if (differenceInYears > 1) {
            this.daysOfLeave += 60; // Days from last fiscal year before separation

            // Count number of months from end of previous fiscal year (September)
            // until the month of separation
            const monthsUntilRetirementYear = 3; // October, November, December
            const monthsUntilRetirementMonth = retirementMonth;
            const months =
              monthsUntilRetirementYear + monthsUntilRetirementMonth;

            // Calculate days of leave
            const daysOfLeave = months * this.DAYS_OF_LEAVE_PER_MONTH;
            this.daysOfTerminalLeave = this.daysOfLeave + daysOfLeave;
          } else if (differenceInYears == 1) {
            // Find months of leave from September of previous year until month of separation
            let months = 0;

            months += 3; // October, November, December
            months += retirementMonth;

            const daysOfLeave = months * this.DAYS_OF_LEAVE_PER_MONTH;
            this.daysOfTerminalLeave = daysOfLeave;
          } else if (differenceInYears == 0) {
            const monthsUntilRetirement = retirementMonth - currentMonth;

            if (monthsUntilRetirement > 1) monthsUntilRetirement -= 1;

            const daysOfLeave =
              monthsUntilRetirement * this.DAYS_OF_LEAVE_PER_MONTH;
            this.daysOfTerminalLeave = daysOfLeave;
          } else {
            this.daysOfTerminalLeave = 0;
          }
          this.onNext();
        },
        handleRetirementFromDatePickerChange() {
          this.retireOnDate = null;

          let ticks = this.getTicks(this.retireFromDate);
          ticks = this.addYearsToDate(ticks);

          this.setRetirementDate(ticks);
        },
        handleRetirementOnDatePickerChange() {
          this.retireFromDate = null;

          const ticks = this.getTicks(this.retireOnDate);

          this.setRetirementDate(ticks);
        },
        handleRetireFromYearsChange() {
          if (this.retireFromDate) {
            this.handleRetirementFromDatePickerChange();
          }
        },
        setRetirementDate(ticks) {
          this.dateWarning = false;

          const date = new Date();
          date.setTime(ticks);

          const dayOfMonth = date.getUTCDate();

          if (dayOfMonth != 1) {
            this.dateWarning = true;
            date.setUTCDate(1);
            if (date.getUTCMonth() != 11)
              date.setUTCMonth(date.getUTCMonth() + 1);
            else {
              date.setUTCMonth(0);
              date.setUTCFullYear(Number(date.getUTCFullYear()) + 1);
            }
          }

          ticks = date.getTime();
          const dateString = this.makeDateString(ticks);
          this.retirementDate = dateString;
          this.retirementTicks = ticks;
        },
        addYearsToDate(ticks) {
          if (ticks) {
            const date = new Date(ticks);
            const currentYear = date.getFullYear();
            const newYear = Number(currentYear) + Number(this.retireFromYears);
            date.setFullYear(newYear);
            return date;
          }
        },
        getTicks(date) {
          const ticks = new Date(date).getTime();
          return ticks;
        },
        makeDateString(ticks) {
          const date = new Date();
          date.setTime(ticks);

          const dayOfMonth = date.getUTCDate();
          const monthOfYear = this.months[date.getUTCMonth()];
          const fullYear = date.getUTCFullYear();

          const dateString = `${dayOfMonth} ${monthOfYear}, ${fullYear}`;
          return dateString;
        },
      },
      mounted() {
        this.isVisible = true;
      },
    });
  </script>
</html>
