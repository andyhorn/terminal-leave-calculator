<!DOCTYPE html>
<html>
  <head>
    <title>Terminal Leave Calculator</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
      integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
      crossorigin="anonymous"
    />
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
  </head>
  <body>
    <div id="app" v-cloak>
      <div class="container">
        <!-- Header Section -->
        <section class="section">
          <h1>Terminal Leave Calculator</h1>
          <p>Let's get started...</p>
        </section>

        <!-- Situation Selection -->
        <section class="section" v-if="currentStep == 0">
          <div class="row">
            <div
              class="col d-flex flex-column justify-content-center align-items-center"
            >
              <p>What is your situation?</p>
              <p v-if="selectedSituation">
                You selected: {{ selectedSituation }}
              </p>
            </div>
            <div class="col">
              <div class="border rounded p-4">
                <div class="form-group">
                  <label for="situation-picker">Pick an Option</label>
                  <select
                    id="situation-picker"
                    v-model="selectedSituation"
                    class="form-control"
                  >
                    <option
                      v-for="(option, index) in situations"
                      :key="index"
                      :value="option"
                      >{{ option }}</option
                    >
                  </select>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Plan to Retire Section -->
        <section class="section" v-if="currentStep == 1">
          <div class="row">
            <div
              class="col d-flex flex-column justify-content-center align-items-center"
            >
              <p class="m-0 p-0">When do you plan to retire?</p>
              <p v-if="retirementDate" class="text-center">
                You selected a retirement date of: {{ retirementDate }}
              </p>
              <p class="text-danger text-center" v-if="dateWarning">
                Note: You can only retire on the 1st of the month; Your date has
                been automatically adjusted.
              </p>
            </div>
            <div class="col">
              <div class="border rounded p-4">
                <div class="form-group">
                  <label for="#retire-on-date-picker">Retire On</label>
                  <input
                    id="retire-on-date-picker"
                    class="form-control"
                    @change="handleRetirementOnDatePickerChange"
                    type="date"
                    v-model="retireOnDate"
                  />
                </div>
              </div>
              <p class="my-5 p-0 text-center">OR</p>
              <div class="border rounded p-4">
                <div class="form-inline">
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <div class="input-group-text">Retire</div>
                    </div>
                    <input
                      type="number"
                      v-model="retireFromYears"
                      class="form-control"
                      min="0"
                      max="100"
                      @change="handleRetireFromYearsChange"
                    />
                    <div class="input-group-append">
                      <div class="input-group-text">years from</div>
                    </div>
                    <input
                      type="date"
                      v-model="retireFromDate"
                      class="form-control w-25"
                      @change="handleRetirementFromDatePickerChange"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- CONUS or OCOUNUS Section -->
        <section class="section" v-if="currentStep == 2">
          <div class="row">
            <div
              class="col d-flex flex-column justify-content-center align-items-center"
            >
              <p>At the time of retirement, will you be CONUS or OCONUS?</p>
              <p v-if="conusSelection">
                You selected: {{ conusSelection.toUpperCase() }}
              </p>
            </div>
            <div class="col">
              <div class="border rounded p-4">
                <div class="custom-control custom-radio p-3">
                  <input
                    class="custom-control-input"
                    type="radio"
                    id="conus-radio"
                    name="conus-selection"
                    value="conus"
                    v-model="conusSelection"
                  />
                  <label
                    for="conus-radio"
                    class="custom-control-label"
                    :class="{ 'radio-active': conusSelection == 'conus' }"
                    >CONUS</label
                  >
                </div>
                <div class="custom-control custom-radio p-3">
                  <input
                    class="custom-control-input"
                    type="radio"
                    id="oconus-radio"
                    name="conus-selection"
                    value="oconus"
                    v-model="conusSelection"
                  />
                  <label
                    for="oconus-radio"
                    class="custom-control-label"
                    :class="{ 'radio-active': conusSelection == 'oconus' }"
                    >OCONUS</label
                  >
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Days of Leave Section -->
        <section class="section" v-if="currentStep == 3">
          <div class="row">
            <div
              class="col d-flex flex-column justify-content-center align-items-center"
            >
              <p>How many days of leave do you plan to have?</p>
            </div>
            <div
              class="col d-flex flex-column justify-content-center align-items-center"
            >
              <div class="border rounded p-3">
                <div class="input-group">
                  <div class="input-group-prepend">
                    <div class="input-group-text">
                      Days of Leave:
                    </div>
                  </div>
                  <input
                    type="number"
                    min="0"
                    max="100"
                    id="days-of-leave-input"
                    v-model="daysOfLeave"
                    class="form-control"
                  />
                  <div class="input-group-append">
                    <button
                      class="btn btn-primary"
                      @click="calculateDaysOfLeave"
                    >
                      Calculate
                    </button>
                  </div>
                </div>
                <p class="text-center m-0 p-4">OR</p>
                <button
                  class="btn btn-primary"
                  @click="calculateMaxDaysOfLeave"
                >
                  Calculate Assuming Standard Maximum
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- Additional Days Section -->
        <section class="section" v-if="currentStep == 4">
          <div class="row">
            <div class="col">
              <p>
                As an involuntary seperatee, you can receive up to thirty (30)
                days of extra leave or ten (10) days of PTDY for transitional
                assistance.
              </p>
              <p>Do you plan to use either?</p>
            </div>
            <div class="col">
              <div class="border rounded p-3">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="involuntaryAssistance"
                    id="involuntary-none-radio"
                    value="0"
                    v-model="involuntaryAssistance"
                  />
                  <label class="form-check-label" for="involuntary-none-radio"
                    >None</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="involuntaryAssistance"
                    id="involuntary-ten-radio"
                    value="10"
                    v-model="involuntaryAssistance"
                  />
                  <label class="form-check-label" for="involuntary-ten-radio"
                    >Ten Days of PTDY</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="involuntaryAssisstance"
                    id="involuntary-thirty-radio"
                    value="30"
                    v-model="involuntaryAssistance"
                  />
                  <label class="form-check-label" for="involuntary-thirty-radio"
                    >Thirty Days of Extra Leave</label
                  >
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="section" v-if="currentStep == 5">
          <div class="row">
            <div class="col">
              <p>Assuming:</p>
              <table class="table">
                <thead>
                  <tr>
                    <th>Final Separation Date</th>
                    <th v-if="daysOfPtdy">Days of PTDY</th>
                    <th v-if="terminalLeave">Days of Terminal Leave</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>{{ retirementDate }}</td>
                    <td v-if="daysOfPtdy">{{ daysOfPtdy }}</td>
                    <td v-if="terminalLeave">{{ daysOfTerminalLeave }}</td>
                  </tr>
                </tbody>
              </table>
              <p>You should start your terminal leave on:</p>
            </div>
            <div class="col">
              <p>{{ beginTerminalLeaveDate }}</p>
            </div>
          </div>
        </section>

        <!-- Button Footer -->
        <section class="section fixed-bottom">
          <div class="row">
            <div class="col d-flex justify-content-center">
              <button
                class="btn btn-primary w-50"
                :disabled="isBackDisabled"
                @click="onBack"
              >
                Back
              </button>
            </div>
            <div class="col d-flex justify-content-center">
              <button
                class="btn btn-primary w-50"
                :disabled="isNextDisabled"
                @click="onNext"
              >
                Next
              </button>
            </div>
          </div>
        </section>
      </div>
    </div>
  </body>

  <style>
    .section {
      padding-top: 3rem;
      padding-bottom: 3rem;
    }
    label.radio-active {
      font-size: 1.1rem;
      font-weight: bold;
      color: green;
    }
    [v-cloak] {
      display: none;
    }
  </style>

  <script>
    var app = new Vue({
      el: "#app",
      data: {
        isVisible: false,
        message: "hello world!",
        situations: [
          "I plan to retire",
          "I plan to separate",
          "I am being honorably involuntarily separated",
        ],
        selectedSituation: "",
        steps: [0, 1, 2, 3, 4, 5],
        currentStep: 0,
        retireOnDate: null,
        retireFromDate: null,
        retirementDate: null,
        retirementTicks: 0,
        dateWarning: false,
        conusSelection: null,
        retireFromYears: 20,
        months: [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December",
        ],
        daysOfLeave: 0,
        daysOfPtdy: null,
        terminalLeave: null,
        beginTerminalLeaveDate: null,
        involuntaryAssistance: null,
      },
      computed: {
        isBackDisabled() {
          return this.currentStep == 0;
        },
        isNextDisabled() {
          if (this.currentStep >= this.steps.length) return true;

          if (this.currentStep == 0) return this.selectedSituation == "";

          if (this.currentStep == 1) return this.retirementDate == null;

          if (this.currentStep == 2) return this.conusSelection == null;

          if (this.currentStep == 4) return this.involuntaryAssistance == null;

          return true;
        },
      },
      methods: {
        onBack() {
          this.currentStep -= 1;
        },
        onNext() {
          if (this.currentStep != 3) this.currentStep += 1;
          else if (this.selectedSituation == this.situations[2])
            this.currentStep += 1;
          else this.currentStep += 2;
        },
        calculateDaysOfLeave() {
          this.onNext();
        },
        calculateMaxDaysOfLeave() {
          this.daysOfLeave = 60;
          this.onNext();
        },
        handleRetirementFromDatePickerChange() {
          this.retireOnDate = null;

          let ticks = this.getTicks(this.retireFromDate);
          ticks = this.addYearsToDate(ticks);

          this.setRetirementDate(ticks);
        },
        handleRetirementOnDatePickerChange() {
          this.retireFromDate = null;

          const ticks = this.getTicks(this.retireOnDate);

          this.setRetirementDate(ticks);
        },
        handleRetireFromYearsChange() {
          if (this.retireFromDate) {
            this.handleRetirementFromDatePickerChange();
          }
        },
        setRetirementDate(ticks) {
          this.dateWarning = false;

          const date = new Date();
          date.setTime(ticks);

          const dayOfMonth = date.getUTCDate();

          if (dayOfMonth != 1) {
            this.dateWarning = true;
            date.setUTCDate(1);
            if (date.getUTCMonth() != 11)
              date.setUTCMonth(date.getUTCMonth() + 1);
            else {
              date.setUTCMonth(0);
              date.setUTCFullYear(Number(date.getUTCFullYear()) + 1);
            }
          }

          ticks = date.getTime();
          const dateString = this.makeDateString(ticks);
          this.retirementDate = dateString;
          this.retirementTicks = ticks;
        },
        addYearsToDate(ticks) {
          if (ticks) {
            const date = new Date(ticks);
            const currentYear = date.getFullYear();
            const newYear = Number(currentYear) + Number(this.retireFromYears);
            date.setFullYear(newYear);
            return date;
          }
        },
        getTicks(date) {
          const ticks = new Date(date).getTime();
          return ticks;
        },
        makeDateString(ticks) {
          const date = new Date();
          date.setTime(ticks);

          const dayOfMonth = date.getUTCDate();
          const monthOfYear = this.months[date.getUTCMonth()];
          const fullYear = date.getUTCFullYear();

          const dateString = `${dayOfMonth} ${monthOfYear}, ${fullYear}`;
          return dateString;
        },
      },
      mounted() {
        this.isVisible = true;
      },
    });
  </script>
</html>
